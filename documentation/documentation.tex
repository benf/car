%% Erläuterungen zu den Befehlen erfolgen unter
%% diesem Beispiel.
\documentclass{scrartcl}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[ngerman]{babel}
\usepackage{amsmath}
\usepackage{listings}
\usepackage{eurosym}

\title{Projekt Dokumentation}
\author{Benjamin Franzke, Jan Klemkow und Maik Rungberg}
\date{03. Januar 2010}

\begin{document}

\maketitle
\tableofcontents

\newpage

\section{Einleitung} %% TODO
	Diese Projekt-Dokumentation beschreibt die komplette Durchfürung des Mikroprozessortechnik-Projektes,
	den Aufbau der einzelnen Schaltungen und einige technische Erläuterungen.

	In den folgenden Kapiteln werden die zwei Schaltungen und zusätzliche Entwicklungen und Umbauten erläutert.
	Als Fahrzeugschaltung wird die Schaltung bezeichnet die in das Fahrzeug verbaut wurde.
	Die Steuerschaltung ist am Computer angeschlossen und sendet die Steuerinformationen an die Fahrzeugschaltung.

\section{Umbau am Auto} %% TODO
	Als Grundlage wurde ein Funkferngesteuertes Auto (RC-Car) benutzt,
	welches im Internet bei ebay.de bestellt wurde.
	Die vorhandene Elektronik zur Funkfernsteuerung wurde entfernt
	und durch eine selbstentwickelte Fahrzeugschaltung ersetzt.
	Vom Fahrzeug wurde das Gestell, die Elektromotoren zum Antrieb und zur Lenkung,
	sowie der Akkumulator übernommen.
	An die Kabel der Elektromotoren wurden Verlängerungen gelötet,
	welche sich einfacher auf dem verwendeten Steckbrett befestigen ließen.

\newpage

\section{Fahrzeugschaltung} %% TODO
	Die Fahrzeugschaltung besteht im Wesentlichen aus einem Mikrocontroller "ATMEGA 16" und einem Funkemfänger "RFM12".
	Versorgt wird die gesamte Schaltung über die im Fahrzeug integrierte Versorungsspannung,
	welche aus einem 10 Volt Akkumulator besteht.
	Da der "ATMEGA 16" eine Spannungsversorgung von 5 Volt benötigt, ist der Festspannungsregler "L7805"
	zwischen Akkumulator und Mikrocontroller geschaltet.

	\subsection{Motoransteuerung}
		Für die Ansteuerung der Elektromotoren des Antriebs und der Lenkung sind vier Motortreiber, vom Typ "L298", verbaut.
		Diese sind aus zwei Gründen notwendig. Zum einen ist das die Steuerung der Drehrichtung der Motoren, praktisch
		bedeutet das vorwärts/rückwärts fahren respektive links/rechts.
		Des weiteren sind die Treiber notwending um den -für den Microcontroller- zu hohen Strom und die höhere Spannung
		für die Motoren zu regulieren bzw. auszuhalten.

		%% TODO: Schaltbild des L298? kann ja gefragt sein in prüfung

		Die verwendeten Bauelemente, vom typ "L298", enthalten jeweils zwei Motortreiber, welche 2A aushalten.
		Insgesamt werden zwei Bauelemente und damit vier Motortreiber benutzt.
		Drei Motortreiber sind für den Antriebsmotor parallel zusammen geschaltet, da dieser 
		bei Messungen teilweise 4A verbraucht hat, somit kann er nun maximal 6A Strom ziehen.
		Der Lenkungsmotor benötigte nur 0.5A somit sollten 2A für diesen ausreichen.
				
		%% TODO: Hier ein Bild vom internen Aufbau des Motortreibers einbinden.

		%% TODO: PWM text prüfen
		Die Geschwindigkeitsregelung ist mittels Pulsweitenmodulation im Mikrocontroller implementiert.
		Die Pulsweitenmodulation basiert auf dem Wechseln zweier Spannungswerte in kurzen Zeitabständen, wobei
		der Mittelwert der Spannungswerte verrechnet mit der Dauer des Auftreten des jeweiligen Wertes,
		der resultierenden Spannung entspricht.
		PWM ist ein DA-Wandler bei dem die Genauigkeit eine untergeordnete Rolle spielt, welche bei
		einem Motor keine Rolle spielt.

		Der Vorteil dieser Methode ist, dass nur ein Pin am ATMEGA verwerndet werden muss, und dass der ATMEGA16 die PWM
		bereits hardwareseitig implementiert hat. Dadurch fällt unnötige Rechenzeit weg.
		Die Anwendung einer solchen PWM besteht also aus der Konfiguration eines Timers,
		der hardwareseitig eine Zahl hochzählt. Dabei ist vor dem Erreichen einer bestimmten
		(eingestellbaren) Zahl der PWM-Ausgang auf Low gesetzt und danach auf High.
		So entstehen unterschiedliche lange Impulse - das arithmetische Mittel variiert je nach eingestellter Zahl.
		Daraus folgt, dass die eingestellte Zahl den Spannungswert repräsentiert.

		Am Motortreiber wird das PWM-Signal am enable Eingang angelegt, da so nur ein Timer für den Motor anfällt.
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%55
		In welche Richtung sich der Motor drehen soll, wird dann an den IN 1..4 Eingängen eingestellt.
		
	
	\subsection{Sensoren}
		Dieser Abschnitt beschreibt die Sensoren, sowie deren Funktionsweisen und Aufgaben
		in der Fahrzeugschaltung.
		\subsubsection{Lichtsensor} %% TODO: maik!
			Für Bestimmung der Helligkeit der Umgebung wurde ein Fotowiderstand benutzt.
			Anhand der Umgebungshelligkeit entscheidet die Fahrzeugschaltung selbstständig,
			zu welchem Zeitpunkt es die Beleuchtung einschaltet.
		\subsubsection{Abstandssensor} %% TODO: maik!
			Der Abstandssensor soll verhindern, dass das Fahrzeug frontal gegen ein Hindernis fährt.
			...%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
			Der verwendete Sensor kann ein Objekt in einer Distanz von 10  bis 80  registrieren
			und dessen Entfernung als Spannungspegel wieder geben. Dieser Spannungswert wird vom
			interen Analog-Digital-Wandler in einen digitalen Wert umgewandelt und kann dann vom
			Programm der Fahrzeugschaltung ausgewertet werden.
			...
			Ab einem vom Programmierer vorgegebenen Wert, werden alle Befehle zum Vorwärtsfahren
			ignoriert, solang bis die Distanz zwischen Hindernis und Fahrzeug wieder innerhalb
			der Toleranz liegt.
	
	\subsection{Programmierung} %% TODO: Erläuterung der Programmierung der Fahrzeugschaltung
		In diesem Abschnitt wird der Programmcode des Steuerkontrolers erklärt.

\newpage

\section{Steuerschaltung}

	\subsection{Kommuniation mit dem Computer} %% TODO
		Die Kommunikation zwischen Steuerschaltung und Computer findet über die RS-232-Schnittstelle statt.
		Diese Schnittstelle verwendet einen Spannungspegel von -15 bis -3 Volt zur Abbildung einer Logischen Eins 
		und einen Spannungspegel von 3 bis 15 Volt für eine Null.
		Der Bereich von -3 bis 3 Volt ist undefiniert.
		Auf Senderseite ist es üblich eine 12 Volt bzw. -12 Volt Spannungspegel für die Kommunikation zu benutzten.

		Diese Definition der RS-232 Schnittstelle, ist für den Verwendeten Mikrocontroller ein Problem,
		da dieser an seinen Pins nur eine Spannungspegel von 0 bis 5 Volt erzeugen kann.

		Zur Erzeugung des notwendigen Spannungspegels von -12 bzw. 12 Volt wird in der Steuerschaltung der Pegelwandler MAX232 benutzt.
		Die folgende Abbildung zeigt die Beschaltung des MAX-232 mit dem Mikrocontroller und der RS-232-Schnittstelle des Computers.
		%% TODO: Bild einfügen von MAX232-µC-PC

		Für die Kommunikation wird eine externer Quarz benötigt, da der intere Quarz zu ungenau und zu fehleranfällig ist.
		Bei einem Versuch mit dem internen Quarz konnte eine Kommunikation mit 600 Baud realisiert werden.
		Diese funktionierte bei einem weiteren Versuch an einem anderen Standort nicht mehr.
		Diese Phänomen kann auf die Fehleranfälligkeit, z.B. in folge von Temperaturveränderungeni, zurückgeführt werden.

	\subsection{Anbindung des Gamepad} %% TODO
		Ein Gamepad wird für die Schnittstelle zum Benutzer verwendet.
		Dafür wurde das Programm "joystick.c" in der Programmiersprache C implementiert,
		welches die Steuerinformationen vom Gamepad über die RS-232 Schnittstelle zum Steuercontroller weiterleitet.
	
	\subsection{Programmierung} %% TODO: Erläuterung der Programmierung der Steuerschaltung
\newpage
\section{Funkstrecke zwischen Fahzeug- und Steuerschaltung} %% TODO
	\subsection{Auswahl des Funkmoduls}
		Als Funkmodul wurde der RFM12 der Firma HOPE RF gewählt.
		Dieses Modul beinhaltet den eigentlichen Funkchip RF12 und die nötige Grundbeschaltung für die Nutzung.

		Die Gründe für die Wahl dieses Moduls liegen im günstigen Preis von 5 EURO pro Stück.
		Weiterhin bietet jedes der Module die Möglichkeit zu Senden und zu Empfangen.
		Dieses Feature wird zwar momentan nicht benutzt, aber bei weiterentwicklungen wenn man Sensordaten
		an den PC zurück schicken möchte, wird es sicher nützlich sein.
		
		Das letzte Kriterium war die einfache ansteuerbarkeit mit einem Protokoll, dass bereits im ATMEGA 
		hardwareseitig implementiert ist.
	\subsection{Implementierung}
		Das Funkmodul RF12 besitzt mehrere unterschiedliche Interfaces 
		zur Kommunikation mit dem Mikrocontroller.
		Alle Einstellungen zur Funküberragung werden Kommandobasiert
		über die SPI-Schnittstelle gesendet.

		Für das Senden/Empfangen der Daten stehen zusätzlich andere Datenleitungen
		zur Verfügung, es besteht aber auch die Möglichkeit die Daten in Befehle
		kodiert über die SPI-Schnittstelle an das Modul zu transferrieren bzw
		durch Kommandos ein Auslesen des FIFO`s zu initiieren.

		Gewählt wurde für dieses Projekt das SPI-Interface, da so die komplette 
		Kommunikation hardwareseitig ablaufen kann und so die Modul-Steuerung einheitlich ist.

		Der RF12 besitzt ein 16bit FIFO in das die Daten direkt hineingeschrieben werden können,
		Der Chip liest die Daten dann aus dem FIFO und versendet sie.
		Dies ist von Vorteil gegenüber anderen Chips des gleichen herstellers (RF02), bei dem
		musste jedes Bit einzeln Übertragen und das Versenden abgewartet werden.

	\subsection{Ablauf Senden/Empfangen}
		Der Sender schreibt zuerst eine sogenannte PREAMBLE bestehend aus dreimal 
		hintereinander 0xAA (hex). Diese signalisiert dem sendenden dass neue Daten 
		Versendet werden sollen.
		Danach wird ein Synchronisierungspattern gesendet 0x2DD4 (hex), dieser wird
		auf Empfaengerseite genutzt um sich zu synchronisieren und schlusszufolgern,
		dass Daten nun gesendet werden. Ob die Empfaengerseite einen
		Synchronisierungspattern nutzen soll ist einstellbar, eine weitere Möglichkeit
		wäre ein VDI (Valid Data Indicator). Es wurde sich in diesem Projekt
		aber für ersteres entschieden.

		Sind nun beide Funk-Chips bereit zu Senden bzw zu empfangen werden nun die Daten
		selbst an den Sender geschickt und auf Empfängerseite vom Chip gelesen.

		Beendet wird ein Transfer auf Senderseite wiederrum durch die PREAMBLE.

	\subsection{Probleme}
		Während der Entwicklung gab es immer wieder Probleme mit undokumentierten Eigentschaften,
		z.b. dass der Chip beim Starten (vom Hersteller auch POR Power-On Reset genannt)
		eine Zeit zum initialisieren brauch, diese Eigenschaften mussten aus dem Beispielcode 
		entnommen werden.
		
		Weiterhin ist das SPI-Interface teilweise verbuggt, sodass Befehle redundant verschickt 
		werden mussten.
		
		%% TODO: add example

\newpage

\section{Quelltext} %% TODO
	In diesem Kapitel werden die einzelnen Quelltexte, der für dieses Projekt entwickelten Programme, aufgelistet.

\include{sender.c}

\end{document}

%% vim: set spelllang=de sts=0 fenc=utf-8: 
